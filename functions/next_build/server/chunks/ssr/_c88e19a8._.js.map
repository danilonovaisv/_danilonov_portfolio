{"version":3,"sources":["../../../../node_modules/.pnpm/next%4016.1.6_%40babel%2Bcore%407.28.6_%40opentelemetry%2Bapi%401.9.0_%40playwright%2Btest%401.58.0_react-d_1d7f1e47d50ae75d5387b46423a1f17f/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../node_modules/.pnpm/next%4016.1.6_%40babel%2Bcore%407.28.6_%40opentelemetry%2Bapi%401.9.0_%40playwright%2Btest%401.58.0_react-d_1d7f1e47d50ae75d5387b46423a1f17f/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../src/lib/supabase/auth-actions.ts","../../../../src/lib/supabase/urls.ts"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","'use server';\n\nimport { redirect } from 'next/navigation';\nimport { createClient } from '@/lib/supabase/server';\n\nexport async function signOut() {\n  const supabase = await createClient();\n  await supabase.auth.signOut();\n  redirect('/admin/login');\n}\n","const normalizeUrl = (value: string) => value.replace(/\\/+$/, '');\n\nexport function getSupabaseBaseUrl(): string | null {\n  const url =\n    process.env.NEXT_PUBLIC_SUPABASE_URL ?? process.env.SUPABASE_URL ?? null;\n\n  if (!url) {\n    throw new Error(\n      'Supabase URL não definida. Configure NEXT_PUBLIC_SUPABASE_URL ou SUPABASE_URL.'\n    );\n  }\n  try {\n    return normalizeUrl(url);\n  } catch {\n    return url;\n  }\n}\n\nexport function normalizeStoragePath(\n  filePath?: string | null,\n  bucket?: string\n): string | null {\n  if (!filePath) return null;\n\n  const bucketPrefix = bucket?.replace(/^\\/+|\\/+$/g, '');\n\n  // Remove full Supabase URL prefix if present (object or render endpoints)\n  let normalized = filePath.trim();\n\n  // Clean common malformed prefixes/suffixes from backups (e.g. \"file_path: ...,\" or quoted values)\n  normalized = normalized.replace(/^file_path:\\s*/i, '');\n  normalized = normalized.replace(/^key:\\s*/i, '');\n  normalized = normalized.replace(/^\"+|\"+$/g, '');\n  normalized = normalized.replace(/^'+|'+$/g, '');\n  normalized = normalized.replace(/,+$/g, '');\n  normalized = normalized.replace(/\\s+$/g, '');\n\n  normalized = normalized.replace(\n    /^https?:\\/\\/[^/]+\\/storage\\/v1\\/(?:render\\/image|object)\\/public\\//,\n    ''\n  );\n\n  // Remove local /storage/v1/object/public prefix if the path was stored like that\n  normalized = normalized.replace(\n    /^\\/?storage\\/v1\\/(?:render\\/image|object)\\/public\\//,\n    ''\n  );\n\n  normalized = normalized.replace(/^\\/+/, '');\n\n  if (bucketPrefix && normalized.startsWith(`${bucketPrefix}/`)) {\n    normalized = normalized.slice(bucketPrefix.length + 1);\n  }\n\n  return normalized;\n}\n\nexport function buildSupabaseStorageUrl(\n  bucket: string,\n  filePath?: string | null\n): string | null {\n  if (!filePath) return null;\n\n  const isHttp =\n    filePath.startsWith('http://') || filePath.startsWith('https://');\n  const isSupabaseUrl = filePath.includes('/storage/v1/');\n\n  // Verifica se é uma URL externa não-Supabase\n  if (isHttp && !isSupabaseUrl) {\n    // Validação de segurança para URLs externas\n    try {\n      const url = new URL(filePath);\n      // Permitir apenas protocolos seguros\n      if (url.protocol !== 'https:') {\n        console.warn(`Protocolo inseguro detectado: ${filePath}`);\n        return null;\n      }\n      // Aqui poderíamos adicionar validação de domínio se necessário\n      return filePath;\n    } catch {\n      console.error(`URL inválida: ${filePath}`);\n      return null;\n    }\n  }\n\n  const cleanBucket = bucket.replace(/^\\/+|\\/+$/g, '');\n  const normalizedPath = normalizeStoragePath(filePath, cleanBucket);\n  if (!normalizedPath) {\n    return filePath.startsWith('http') ? filePath : null;\n  }\n\n  // Preserva a origem caso o caminho já seja uma URL completa de outro projeto Supabase\n  if (isHttp && isSupabaseUrl) {\n    try {\n      const url = new URL(filePath);\n      const baseOrigin = `${url.protocol}//${url.host}`;\n      return `${baseOrigin}/storage/v1/object/public/${cleanBucket}/${normalizedPath}`;\n    } catch {\n      // se falhar, segue fluxo padrão\n    }\n  }\n\n  const baseUrl = getSupabaseBaseUrl();\n  if (!baseUrl) {\n    return filePath.startsWith('http') ? filePath : null;\n  }\n\n  return `${baseUrl}/storage/v1/object/public/${cleanBucket}/${normalizedPath}`;\n}\n\n// Função adicional para validar e construir URLs de links externos\nexport function validateExternalUrl(url: string): string | null {\n  if (!url) return null;\n  const normalized = url.trim();\n  if (!normalized) return null;\n\n  const allowedProtocols = ['https:', 'http:'];\n\n  try {\n    const parsedUrl = new URL(normalized);\n    if (allowedProtocols.includes(parsedUrl.protocol)) {\n      return parsedUrl.toString();\n    }\n\n    console.warn(`Link externo inseguro bloqueado: ${url}`);\n    return null;\n  } catch {\n    if (normalized.startsWith('/') || normalized.startsWith('#')) {\n      return normalized;\n    }\n\n    if (normalized.startsWith('//')) {\n      try {\n        const parsedFallback = new URL(`https:${normalized}`);\n        return parsedFallback.toString();\n      } catch {\n        console.error(`URL externa inválida: ${url}`);\n        return null;\n      }\n    }\n\n    console.error(`URL externa inválida: ${url}`);\n    return null;\n  }\n}\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"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","ignoreList":[0,1]}