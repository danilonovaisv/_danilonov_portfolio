{"version":3,"sources":["../../../../src/config/admin-navigation.ts","../../../../src/app/admin/%28auth%29/login/page.tsx","../../../../src/components/admin/LoginForm.tsx"],"sourcesContent":["export const ADMIN_NAVIGATION = {\n  dashboard: '/admin',\n  trabalhos: {\n    index: '/admin/trabalhos',\n    new: '/admin/trabalhos/new',\n    detail: (id: string) => `/admin/trabalhos/${id}`,\n  },\n  tags: '/admin/tags',\n  midia: '/admin/midia',\n  'landing-pages': '/admin/landing-pages',\n  config: '/admin/config',\n} as const;\n","// Client component for login\n'use client';\n\nimport { Suspense } from 'react';\nimport LoginForm from '@/components/admin/LoginForm';\n\nexport default function LoginPage() {\n  return (\n    <Suspense\n      fallback={\n        <div className=\"space-y-6\">\n          <p className=\"text-sm uppercase tracking-[0.25em] text-slate-400\">\n            Admin\n          </p>\n          <h1 className=\"text-2xl font-semibold mt-2\">Carregando...</h1>\n        </div>\n      }\n    >\n      <LoginForm />\n    </Suspense>\n  );\n}\n","'use client';\n\nimport { useState, useTransition, useEffect } from 'react';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport { createClientComponentClient } from '@/lib/supabase/client';\nimport { ADMIN_NAVIGATION } from '@/config/admin-navigation';\n\nexport default function LoginForm() {\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [error, setError] = useState<string | null>(null);\n  const [isPending, startTransition] = useTransition();\n  const [isRedirecting, setIsRedirecting] = useState(false);\n  const router = useRouter();\n  const searchParams = useSearchParams();\n\n  // Check for auth errors from callback\n  useEffect(() => {\n    const authError = searchParams.get('error');\n    if (authError) {\n      setError('Erro na autenticação. Por favor, tente novamente.');\n    }\n  }, [searchParams]);\n\n  // Check if already logged in on mount\n  useEffect(() => {\n    // const checkSession = async () => {\n    //   const supabase = createClientComponentClient();\n    //   // Use getUser instead of getSession for better server consistency\n    //   const {\n    //     data: { user },\n    //   } = await supabase.auth.getUser();\n    //   if (user) {\n    //     setIsRedirecting(true);\n    //     // Ensure server sync before client navigation\n    //     router.refresh();\n    //     router.replace(ADMIN_NAVIGATION.dashboard);\n    //   }\n    // };\n    // checkSession();\n  }, [router]);\n\n  const handleSubmit = (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    setError(null);\n\n    startTransition(async () => {\n      try {\n        const supabase = createClientComponentClient();\n        const { data, error: signInError } =\n          await supabase.auth.signInWithPassword({\n            email,\n            password,\n          });\n\n        if (signInError) {\n          setError(signInError.message);\n          return;\n        }\n\n        if (data.session) {\n          setIsRedirecting(true);\n          // Important: Refresh ensures Next.js Server Components see the new cookies\n          router.refresh();\n\n          // Use a small delay and window.location.href for a full reload\n          // This ensures cookies are properly picked up by the server on next load\n          setTimeout(() => {\n            window.location.href = ADMIN_NAVIGATION.dashboard;\n          }, 500);\n        } else {\n          setError('Falha ao estabelecer sessão. Tente novamente.');\n        }\n      } catch (err) {\n        console.error('Login error:', err);\n        setError('Ocorreu um erro inesperado.');\n      }\n    });\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <p className=\"text-sm uppercase tracking-[0.25em] text-slate-400\">\n          Admin\n        </p>\n        <h1 className=\"text-2xl font-semibold mt-2\">Entrar no painel</h1>\n        <p className=\"text-sm text-slate-400 mt-1\">\n          Use seu email e senha do Supabase Auth.\n        </p>\n      </div>\n\n      <form className=\"space-y-4\" onSubmit={handleSubmit}>\n        <label className=\"flex flex-col gap-2\">\n          <span className=\"text-sm text-slate-300\">Email</span>\n          <input\n            type=\"email\"\n            required\n            className=\"rounded-md bg-slate-900/60 border border-white/10 px-3 py-2 text-sm\"\n            value={email}\n            onChange={(e) => setEmail(e.target.value)}\n          />\n        </label>\n        <label className=\"flex flex-col gap-2\">\n          <span className=\"text-sm text-slate-300\">Senha</span>\n          <input\n            type=\"password\"\n            required\n            className=\"rounded-md bg-slate-900/60 border border-white/10 px-3 py-2 text-sm\"\n            value={password}\n            onChange={(e) => setPassword(e.target.value)}\n          />\n        </label>\n\n        {error && <div className=\"text-sm text-red-400\">{error}</div>}\n\n        <button\n          type=\"submit\"\n          className=\"w-full rounded-md bg-blue-500 py-2 text-sm font-semibold text-white shadow transition hover:bg-blue-600 disabled:opacity-60\"\n          disabled={isPending || isRedirecting}\n        >\n          {isRedirecting\n            ? 'Redirecionando...'\n            : isPending\n              ? 'Entrando...'\n              : 'Entrar'}\n        </button>\n      </form>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}