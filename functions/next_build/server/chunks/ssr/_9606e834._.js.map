{"version":3,"sources":["../../../../src/lib/supabase/server.ts","../../../../node_modules/.pnpm/next%4016.1.6_%40babel%2Bcore%407.28.6_%40opentelemetry%2Bapi%401.9.0_%40playwright%2Btest%401.58.0_react-d_1d7f1e47d50ae75d5387b46423a1f17f/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../src/lib/supabase/queries/projects.ts","../../../../.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["import { createServerClient } from '@supabase/ssr';\nimport { cookies } from 'next/headers';\n\nexport async function createClient() {\n  let cookieStore: Awaited<ReturnType<typeof cookies>> | undefined;\n  try {\n    cookieStore = await cookies();\n  } catch {\n    // During build/static generation, cookies() might not be available\n  }\n\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\n  const supabaseKey =\n    process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_DEFAULT_KEY ??\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\n  if (!supabaseUrl) {\n    throw new Error('NEXT_PUBLIC_SUPABASE_URL não está definida no ambiente.');\n  }\n\n  if (!supabaseKey) {\n    throw new Error(\n      'Defina NEXT_PUBLIC_SUPABASE_PUBLISHABLE_DEFAULT_KEY ou NEXT_PUBLIC_SUPABASE_ANON_KEY.'\n    );\n  }\n\n  return createServerClient(supabaseUrl, supabaseKey, {\n    cookieOptions: {\n      // Firebase Hosting (Functions/Frameworks) só encaminha \"__session\"\n      name: '__session',\n      sameSite: 'lax',\n      secure: true,\n    },\n    cookies: {\n      getAll() {\n        return cookieStore?.getAll() ?? [];\n      },\n      setAll(cookiesToSet) {\n        try {\n          cookiesToSet.forEach(({ name, value, options }) =>\n            cookieStore?.set(name, value, options)\n          );\n        } catch {\n          // The `setAll` method was called from a Server Component.\n        }\n      },\n    },\n  });\n}\n","/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","import { createClient } from '@/lib/supabase/server';\nimport type { DbProject, DbTag } from '@/types/admin';\nimport type { SupabaseClient } from '@supabase/supabase-js';\n\ntype ProjectFilters = {\n  tagSlug?: string;\n  year?: number;\n  search?: string;\n  includeUnpublished?: boolean;\n  featuredOnHome?: boolean;\n  featuredOnPortfolio?: boolean;\n};\n\nexport type DbProjectWithTags = DbProject & {\n  tags?: Array<{ tag: DbTag } | null> | null;\n  landing_page?: { slug: string } | null;\n};\n\nexport async function listProjects(\n  filters: ProjectFilters = {},\n  supabaseClient?: SupabaseClient\n) {\n  const supabase = supabaseClient ?? (await createClient());\n\n  let query = supabase\n    .from('portfolio_projects')\n    .select(\n      '*, tags:portfolio_project_tags(tag:portfolio_tags(id, slug, label, kind)), landing_page:landing_pages(slug)'\n    )\n    .order('featured_portfolio_order', { ascending: true, nullsFirst: false });\n\n  if (!filters.includeUnpublished) {\n    query = query.eq('is_published', true);\n  }\n\n  if (filters.tagSlug) {\n    query = query.eq('tags.tag.slug', filters.tagSlug);\n  }\n\n  if (filters.year) {\n    query = query.eq('year', filters.year);\n  }\n\n  if (filters.search) {\n    query = query.or(\n      `title.ilike.%${filters.search}%,client_name.ilike.%${filters.search}%`\n    );\n  }\n\n  if (filters.featuredOnHome) {\n    query = query.eq('featured_on_home', true);\n  }\n\n  if (filters.featuredOnPortfolio) {\n    query = query.eq('featured_on_portfolio', true);\n  }\n\n  const { data, error } = await query.returns<DbProjectWithTags[]>();\n  if (error) throw error;\n  return data;\n}\n\nexport async function getProject(id: string) {\n  const supabase = await createClient();\n  const { data, error } = await supabase\n    .from('portfolio_projects')\n    .select(\n      '*, tags:portfolio_project_tags(tag:portfolio_tags(id, slug, label, kind))'\n    )\n    .eq('id', id)\n    .single();\n\n  if (error) throw error;\n  return data as DbProject;\n}\n\nexport async function upsertProject(\n  payload: Partial<DbProject> & { id?: string; tagIds?: string[] }\n) {\n  const supabase = await createClient();\n\n  const { tagIds, ...projectData } = payload;\n\n  const { data, error } = await supabase\n    .from('portfolio_projects')\n    .upsert(projectData, { onConflict: 'id' })\n    .select()\n    .single();\n\n  if (error) throw error;\n\n  if (tagIds && data?.id) {\n    await supabase\n      .from('portfolio_project_tags')\n      .delete()\n      .eq('project_id', data.id);\n    if (tagIds.length > 0) {\n      const relations = tagIds.map((tagId) => ({\n        project_id: data.id,\n        tag_id: tagId,\n      }));\n      const { error: relError } = await supabase\n        .from('portfolio_project_tags')\n        .insert(relations);\n      if (relError) throw relError;\n    }\n  }\n\n  return data as DbProject;\n}\n\nexport async function togglePublish(formData: FormData) {\n  'use server';\n  const projectId = formData.get('id') as string;\n  const nextStatus = (formData.get('nextStatus') as string) === 'true';\n  const supabase = await createClient();\n  const { error } = await supabase\n    .from('portfolio_projects')\n    .update({ is_published: nextStatus })\n    .eq('id', projectId);\n  if (error) throw error;\n}\n\nexport async function deleteProject(projectId: string) {\n  const supabase = await createClient();\n  const { error } = await supabase\n    .from('portfolio_projects')\n    .delete()\n    .eq('id', projectId);\n  if (error) throw error;\n}\n","export {$$RSC_SERVER_ACTION_0 as '401b3d172a363b3a268da5079a5177a5f84f1cd63f'} from 'ACTIONS_MODULE0'\n"],"names":["registerServerReference"],"mappings":"uCAAA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEO,eAAe,IACpB,IAAI,EACJ,GAAI,CACF,EAAc,MAAM,CAAA,EAAA,EAAA,OAAA,AAAO,GAC7B,CAAE,KAAM,CAER,CAiBA,MAAO,CAAA,EAAA,EAAA,kBAAA,AAAkB,EAfnB,AAeoB,aAAa,8BAbrC,iDAakD,CAClD,cAAe,CAEb,KAAM,YACN,SAAU,MACV,QAAQ,CACV,EACA,QAAS,QACP,IACS,GAAa,UAAY,EAAE,CAEpC,OAAO,CAAY,EACjB,GAAI,CACF,EAAa,OAAO,CAAC,CAAC,MAAE,CAAI,OAAE,CAAK,SAAE,CAAO,CAAE,GAC5C,GAAa,IAAI,EAAM,EAAO,GAElC,CAAE,KAAM,CAER,CACF,CACF,CACF,EACF,2DChDoD,OAAA,cAAA,CAAA,EAAA,aAAA,oCAC3CA,0BAAAA,qCAAAA,EAAAA,uBAAuB,YAAQ,CAAA,CAAA,IAAA,4CCDxC,EAAA,EAAA,CAAA,CAAA,OAkBO,eAAe,EACpB,EAA0B,CAAC,CAAC,CAC5B,CAA+B,EAI/B,IAAI,EAAQ,CAFK,GAAmB,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,GAAA,EAGnD,IAAI,CAAC,sBACL,MAAM,CACL,+GAED,KAAK,CAAC,2BAA4B,CAAE,WAAW,EAAM,YAAY,CAAM,EAEtE,CAAC,EAAQ,kBAAkB,EAAE,AAC/B,GAAQ,EAAM,EAAE,CAAC,gBAAgB,EAAA,EAG/B,EAAQ,OAAO,EAAE,CACnB,EAAQ,EAAM,EAAE,CAAC,gBAAiB,EAAQ,QAAO,EAG/C,EAAQ,IAAI,EAAE,AAChB,GAAQ,EAAM,EAAE,CAAC,OAAQ,EAAQ,KAAI,EAGnC,EAAQ,MAAM,EAAE,CAClB,EAAQ,EAAM,EAAE,CACd,CAAC,aAAa,EAAE,EAAQ,MAAM,CAAC,qBAAqB,EAAE,EAAQ,MAAM,CAAC,CAAC,EAAC,EAIvE,EAAQ,cAAc,EAAE,CAC1B,EAAQ,EAAM,EAAE,CAAC,oBAAoB,EAAA,EAGnC,EAAQ,mBAAmB,EAAE,CAC/B,EAAQ,EAAM,EAAE,CAAC,wBAAyB,GAAA,EAG5C,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAM,OAAO,GAC3C,GAAI,EAAO,MAAM,EACjB,OAAO,CACT,KAmDO,EAAA,eAAe,AAAc,CAAkB,EAEpD,IAAM,EAAY,EAAS,GAAG,CAAC,MACzB,EAAwD,SAA1C,EAAS,GAAG,CAAC,cAC3B,EAAW,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,IAC7B,OAAE,CAAK,CAAE,CAAG,MAAM,EACrB,IAAI,CAAC,sBACL,MAAM,CAAC,CAAE,aAAc,CAAW,GAClC,EAAE,CAAC,KAAM,GACZ,GAAI,EAAO,MAAM,CACnB,gCAVO,EAAA,6CAAA,gFAAA,4BC/GP,IAAA,EAAA,EAAA,CAAA,CAAA","ignoreList":[1]}