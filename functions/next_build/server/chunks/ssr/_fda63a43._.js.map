{"version":3,"sources":["../../../../node_modules/.pnpm/next%4016.1.6_%40babel%2Bcore%407.28.6_%40opentelemetry%2Bapi%401.9.0_%40playwright%2Btest%401.58.0_react-d_1d7f1e47d50ae75d5387b46423a1f17f/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../node_modules/.pnpm/next%4016.1.6_%40babel%2Bcore%407.28.6_%40opentelemetry%2Bapi%401.9.0_%40playwright%2Btest%401.58.0_react-d_1d7f1e47d50ae75d5387b46423a1f17f/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../src/lib/supabase/auth-actions.ts","../../../../src/lib/supabase/queries/projects.ts","../../../../.next-internal/server/app/admin/%28protected%29/trabalhos/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","'use server';\n\nimport { redirect } from 'next/navigation';\nimport { createClient } from '@/lib/supabase/server';\n\nexport async function signOut() {\n  const supabase = await createClient();\n  await supabase.auth.signOut();\n  redirect('/admin/login');\n}\n","import { createClient } from '@/lib/supabase/server';\nimport type { DbProject, DbTag } from '@/types/admin';\nimport type { SupabaseClient } from '@supabase/supabase-js';\n\ntype ProjectFilters = {\n  tagSlug?: string;\n  year?: number;\n  search?: string;\n  includeUnpublished?: boolean;\n  featuredOnHome?: boolean;\n  featuredOnPortfolio?: boolean;\n};\n\nexport type DbProjectWithTags = DbProject & {\n  tags?: Array<{ tag: DbTag } | null> | null;\n  landing_page?: { slug: string } | null;\n};\n\nexport async function listProjects(\n  filters: ProjectFilters = {},\n  supabaseClient?: SupabaseClient\n) {\n  const supabase = supabaseClient ?? (await createClient());\n\n  let query = supabase\n    .from('portfolio_projects')\n    .select(\n      '*, tags:portfolio_project_tags(tag:portfolio_tags(id, slug, label, kind)), landing_page:landing_pages(slug)'\n    )\n    .order('featured_portfolio_order', { ascending: true, nullsFirst: false });\n\n  if (!filters.includeUnpublished) {\n    query = query.eq('is_published', true);\n  }\n\n  if (filters.tagSlug) {\n    query = query.eq('tags.tag.slug', filters.tagSlug);\n  }\n\n  if (filters.year) {\n    query = query.eq('year', filters.year);\n  }\n\n  if (filters.search) {\n    query = query.or(\n      `title.ilike.%${filters.search}%,client_name.ilike.%${filters.search}%`\n    );\n  }\n\n  if (filters.featuredOnHome) {\n    query = query.eq('featured_on_home', true);\n  }\n\n  if (filters.featuredOnPortfolio) {\n    query = query.eq('featured_on_portfolio', true);\n  }\n\n  const { data, error } = await query.returns<DbProjectWithTags[]>();\n  if (error) throw error;\n  return data;\n}\n\nexport async function getProject(id: string) {\n  const supabase = await createClient();\n  const { data, error } = await supabase\n    .from('portfolio_projects')\n    .select(\n      '*, tags:portfolio_project_tags(tag:portfolio_tags(id, slug, label, kind))'\n    )\n    .eq('id', id)\n    .single();\n\n  if (error) throw error;\n  return data as DbProject;\n}\n\nexport async function upsertProject(\n  payload: Partial<DbProject> & { id?: string; tagIds?: string[] }\n) {\n  const supabase = await createClient();\n\n  const { tagIds, ...projectData } = payload;\n\n  const { data, error } = await supabase\n    .from('portfolio_projects')\n    .upsert(projectData, { onConflict: 'id' })\n    .select()\n    .single();\n\n  if (error) throw error;\n\n  if (tagIds && data?.id) {\n    await supabase\n      .from('portfolio_project_tags')\n      .delete()\n      .eq('project_id', data.id);\n    if (tagIds.length > 0) {\n      const relations = tagIds.map((tagId) => ({\n        project_id: data.id,\n        tag_id: tagId,\n      }));\n      const { error: relError } = await supabase\n        .from('portfolio_project_tags')\n        .insert(relations);\n      if (relError) throw relError;\n    }\n  }\n\n  return data as DbProject;\n}\n\nexport async function togglePublish(formData: FormData) {\n  'use server';\n  const projectId = formData.get('id') as string;\n  const nextStatus = (formData.get('nextStatus') as string) === 'true';\n  const supabase = await createClient();\n  const { error } = await supabase\n    .from('portfolio_projects')\n    .update({ is_published: nextStatus })\n    .eq('id', projectId);\n  if (error) throw error;\n}\n\nexport async function deleteProject(projectId: string) {\n  const supabase = await createClient();\n  const { error } = await supabase\n    .from('portfolio_projects')\n    .delete()\n    .eq('id', projectId);\n  if (error) throw error;\n}\n","export {signOut as '00e0bbc6fb7040e91f5c5e046e7de36c8ccd37a8f7'} from 'ACTIONS_MODULE0'\nexport {$$RSC_SERVER_ACTION_0 as '402e60c045248e908816e10b49cb9ae835c7f71476'} from 'ACTIONS_MODULE1'\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"6CAAoD,OAAA,cAAA,CAAA,EAAA,aAAA,oCAC3CA,0BAAAA,qCAAAA,EAAAA,uBAAuB,YAAQ,CAAA,CAAA,IAAA,gCCEjC,SAASC,EAAyBC,CAAc,EACrD,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAQE,MAAM,CAAED,IAAK,CACvC,IAAME,EAASH,CAAO,CAACC,EAAE,CACzB,GAAsB,YAAlB,AAA8B,OAAvBE,EACT,MAAM,OAAA,cAEL,CAFK,AAAIC,MACR,CAAC,2DAA2D,EAAE,OAAOD,EAAO;AAAA,oEAAuE,CAAC,EADhJ,oBAAA,OAAA,mBAAA,eAAA,EAEN,EAEJ,CACF,0EATgBJ,2BAAAA,qCAAAA,8CCDhB,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEO,eAAe,IACpB,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,GACnC,OAAM,EAAS,IAAI,CAAC,OAAO,GAC3B,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,eACX,yCAJsB,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,sECLtB,EAAA,EAAA,CAAA,CAAA,OAkBO,eAAe,EACpB,EAA0B,CAAC,CAAC,CAC5B,CAA+B,EAI/B,IAAI,EAAQ,CAFK,GAAmB,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,GAAA,EAGnD,IAAI,CAAC,sBACL,MAAM,CACL,+GAED,KAAK,CAAC,2BAA4B,CAAE,WAAW,EAAM,YAAY,CAAM,EAEtE,CAAC,EAAQ,kBAAkB,EAAE,CAC/B,EAAQ,EAAM,EAAE,CAAC,eAAgB,GAAA,EAG/B,EAAQ,OAAO,EAAE,CACnB,EAAQ,EAAM,EAAE,CAAC,gBAAiB,EAAQ,QAAO,EAG/C,EAAQ,IAAI,EAAE,CAChB,EAAQ,EAAM,EAAE,CAAC,OAAQ,EAAQ,IAAI,GAGnC,EAAQ,MAAM,EAAE,CAClB,EAAQ,EAAM,EAAE,CACd,CAAC,aAAa,EAAE,EAAQ,MAAM,CAAC,qBAAqB,EAAE,EAAQ,MAAM,CAAC,CAAC,EAAC,EAIvE,EAAQ,cAAc,EAAE,CAC1B,EAAQ,EAAM,EAAE,CAAC,mBAAoB,GAAA,EAGnC,EAAQ,mBAAmB,EAAE,CAC/B,EAAQ,EAAM,EAAE,CAAC,yBAAyB,EAAA,EAG5C,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAM,OAAO,GAC3C,GAAI,EAAO,MAAM,EACjB,OAAO,CACT,KAmDO,EAAA,eAAe,AAAc,CAAkB,EAEpD,IAAM,EAAY,EAAS,GAAG,CAAC,MACzB,EAAwD,SAA1C,EAAS,GAAG,CAAC,cAC3B,EAAW,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,IAC7B,OAAE,CAAK,CAAE,CAAG,MAAM,EACrB,IAAI,CAAC,sBACL,MAAM,CAAC,CAAE,aAAc,CAAW,GAClC,EAAE,CAAC,KAAM,GACZ,GAAI,EAAO,MAAM,CACnB,gCAVO,EAAA,6CAAA,gFAAA,4BC/GP,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA","ignoreList":[0,1]}