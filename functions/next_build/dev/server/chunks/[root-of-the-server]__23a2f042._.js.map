{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/danilonovais/_danilonov_portfolio/src/lib/supabase/middleware.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr';\nimport { NextResponse, type NextRequest } from 'next/server';\n\n// Fallback URLs case env vars are not available (shouldn't happen with NEXT_PUBLIC_*)\nconst SUPABASE_URL =\n  process.env.NEXT_PUBLIC_SUPABASE_URL ||\n  'https://umkmwbkwvulxtdodzmzf.supabase.co';\nconst SUPABASE_ANON_KEY =\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY ||\n  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVta213Ymt3dnVseHRkb2R6bXpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNDE4MzcsImV4cCI6MjA4MzkxNzgzN30.wssvD9W-yzRyLpq8aMCw57E4wNz7OnQ58ujLzYmF6CA';\n\nexport async function updateSession(request: NextRequest) {\n  let supabaseResponse = NextResponse.next({\n    request,\n  });\n\n  const supabase = createServerClient(SUPABASE_URL, SUPABASE_ANON_KEY, {\n    cookieOptions: {\n      // Firebase Hosting só encaminha o cookie \"__session\" para as Functions.\n      name: '__session',\n      sameSite: 'lax',\n      secure: true,\n    },\n    cookies: {\n      getAll() {\n        return request.cookies.getAll();\n      },\n      setAll(cookiesToSet) {\n        // request.cookies é imutável; apenas refletimos no response.\n        supabaseResponse = NextResponse.next({ request });\n        cookiesToSet.forEach(({ name, value, options }) =>\n          supabaseResponse.cookies.set(name, value, options)\n        );\n      },\n    },\n  });\n\n  // IMPORTANT: Do not use auth.getSession() - it reads from cookies without validation\n  // Use auth.getUser() which always validates the session with Supabase Auth server\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  const pathname = request.nextUrl.pathname;\n  const isLoginPage = pathname === '/admin/login';\n  const isAdminRoute = pathname.startsWith('/admin');\n  const isAuthCallbackRoute = pathname.startsWith('/auth/callback');\n\n  // Skip auth callback route\n  if (isAuthCallbackRoute) {\n    return supabaseResponse;\n  }\n\n  // If user is logged in and trying to access login page, redirect to dashboard\n  if (user && isLoginPage) {\n    const url = request.nextUrl.clone();\n    url.pathname = '/admin';\n    const redirectResponse = NextResponse.redirect(url);\n    // Copy cookies from supabaseResponse to ensure session persistence\n    const cookiesToSet = supabaseResponse.cookies.getAll();\n    cookiesToSet.forEach((cookie) =>\n      redirectResponse.cookies.set(cookie.name, cookie.value, cookie)\n    );\n    return redirectResponse;\n  }\n\n  // Protect /admin routes (except login)\n  if (isAdminRoute && !isLoginPage) {\n    if (!user) {\n      const url = request.nextUrl.clone();\n      url.pathname = '/admin/login';\n      const redirectResponse = NextResponse.redirect(url);\n      // Copy cookies from supabaseResponse to ensure session persistence\n      const cookiesToSet = supabaseResponse.cookies.getAll();\n      cookiesToSet.forEach((cookie) =>\n        redirectResponse.cookies.set(cookie.name, cookie.value, cookie)\n      );\n      return redirectResponse;\n    }\n\n    // Se precisar de papel admin, reative o check abaixo.\n    // const userRole = user.app_metadata?.role || 'user';\n    // if (userRole !== 'admin') {\n    //   const url = request.nextUrl.clone();\n    //   url.pathname = '/';\n    //   return NextResponse.redirect(url);\n    // }\n  }\n\n  return supabaseResponse;\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEA,sFAAsF;AACtF,MAAM,eACJ,gFACA;AACF,MAAM,oBACJ,wPACA;AAEK,eAAe,cAAc,OAAoB;IACtD,IAAI,mBAAmB,6VAAY,CAAC,IAAI,CAAC;QACvC;IACF;IAEA,MAAM,WAAW,IAAA,4SAAkB,EAAC,cAAc,mBAAmB;QACnE,eAAe;YACb,wEAAwE;YACxE,MAAM;YACN,UAAU;YACV,QAAQ;QACV;QACA,SAAS;YACP;gBACE,OAAO,QAAQ,OAAO,CAAC,MAAM;YAC/B;YACA,QAAO,YAAY;gBACjB,6DAA6D;gBAC7D,mBAAmB,6VAAY,CAAC,IAAI,CAAC;oBAAE;gBAAQ;gBAC/C,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,iBAAiB,OAAO,CAAC,GAAG,CAAC,MAAM,OAAO;YAE9C;QACF;IACF;IAEA,qFAAqF;IACrF,kFAAkF;IAClF,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,MAAM,WAAW,QAAQ,OAAO,CAAC,QAAQ;IACzC,MAAM,cAAc,aAAa;IACjC,MAAM,eAAe,SAAS,UAAU,CAAC;IACzC,MAAM,sBAAsB,SAAS,UAAU,CAAC;IAEhD,2BAA2B;IAC3B,IAAI,qBAAqB;QACvB,OAAO;IACT;IAEA,8EAA8E;IAC9E,IAAI,QAAQ,aAAa;QACvB,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;QACjC,IAAI,QAAQ,GAAG;QACf,MAAM,mBAAmB,6VAAY,CAAC,QAAQ,CAAC;QAC/C,mEAAmE;QACnE,MAAM,eAAe,iBAAiB,OAAO,CAAC,MAAM;QACpD,aAAa,OAAO,CAAC,CAAC,SACpB,iBAAiB,OAAO,CAAC,GAAG,CAAC,OAAO,IAAI,EAAE,OAAO,KAAK,EAAE;QAE1D,OAAO;IACT;IAEA,uCAAuC;IACvC,IAAI,gBAAgB,CAAC,aAAa;QAChC,IAAI,CAAC,MAAM;YACT,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;YACjC,IAAI,QAAQ,GAAG;YACf,MAAM,mBAAmB,6VAAY,CAAC,QAAQ,CAAC;YAC/C,mEAAmE;YACnE,MAAM,eAAe,iBAAiB,OAAO,CAAC,MAAM;YACpD,aAAa,OAAO,CAAC,CAAC,SACpB,iBAAiB,OAAO,CAAC,GAAG,CAAC,OAAO,IAAI,EAAE,OAAO,KAAK,EAAE;YAE1D,OAAO;QACT;IAEA,sDAAsD;IACtD,sDAAsD;IACtD,8BAA8B;IAC9B,yCAAyC;IACzC,wBAAwB;IACxB,uCAAuC;IACvC,IAAI;IACN;IAEA,OAAO;AACT"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///Users/danilonovais/_danilonov_portfolio/src/proxy.ts"],"sourcesContent":["import { type NextRequest } from 'next/server';\nimport { updateSession } from './lib/supabase/middleware';\n\nexport async function proxy(request: NextRequest) {\n  return await updateSession(request);\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except for the ones starting with:\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     * Feel free to modify this pattern to include more paths.\n     */\n    '/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',\n  ],\n};\n"],"names":[],"mappings":";;;;;;AACA;;AAEO,eAAe,MAAM,OAAoB;IAC9C,OAAO,MAAM,IAAA,qJAAa,EAAC;AAC7B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;KAMC,GACD;KACD;AACH"}}]
}